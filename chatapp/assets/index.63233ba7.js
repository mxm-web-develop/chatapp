var j=Object.defineProperty,T=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var b=(e,t,s)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,m=(e,t)=>{for(var s in t||(t={}))k.call(t,s)&&b(e,s,t[s]);if(w)for(var s of w(t))L.call(t,s)&&b(e,s,t[s]);return e},v=(e,t)=>T(e,A(t));import{r as d,j as r,l as E,a as f,R as B,M as _,F,T as O,i as G,P as U,I as R,b as H}from"./vendor.8c432917.js";const P=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))o(u);new MutationObserver(u=>{for(const n of u)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(u){const n={};return u.integrity&&(n.integrity=u.integrity),u.referrerpolicy&&(n.referrerPolicy=u.referrerpolicy),u.crossorigin==="use-credentials"?n.credentials="include":u.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(u){if(u.ep)return;u.ep=!0;const n=s(u);fetch(u.href,n)}};P();var I=[{userId:"sdfjsd1l241511342",avator:"/photo.png",userName:"\u5F20\u5C0F\u4E00",userIntro:"\u5929\u4E0B\u7B2C\u4E00"},{userId:"sdfjl42144211o",avator:"/photo.png",userName:"\u5F20\u5C0F\u4E8C",userIntro:"\u5929\u4E0B\u7B2C\u4E8C"},{userId:"sdfjl531ddf541z3",avator:"/photo.png",userName:"\u5F20\u5C0F\u4E09",userIntro:"\u5929\u4E0B\u7B2C\u4E09"}],V=[{from:"sdfjlsdfi3l22fd2o",to:"admintestuser",id:"sdkfjsdlf5125adslfiei2i2",date:"1633693542538",type:"text/plain",content:"\u8FD9\u91CC\u662F\u4E00\u6761\u804A\u5929\u5185\u5BB9"},{to:"sdfjsd1l241511342",from:"admintestuser",id:"sdkfjs114512dlfadslfiei2i2",date:"1633693541538",type:"text/plain",content:"\u8FD9\u91CC\u662F\u4E00\u56DE\u590D\u6D88\u606F"},{from:"sdfjsd1l241511342",to:"admintestuser",id:"sdkfjsdlfasdfsdfdslfiei2i2",date:"1633693562538",type:"text/plain",content:"\u8FD9\u91CC\u51C9\u5FEB\u70B9\u624B\u673A\u8D39\uFF1B\u6765\u5723\u8BDE\u8282\u4F5Bis\u7684\u98DE\u673A\u54E6 "},{from:"sdfjsd1l241511342",to:"admintestuser",id:"sdkfjsdlsdfsdffadslfiei2i2",date:"1633693582538",type:"text/plain",content:"\u8FD9\u91CC\u662Fdemo\u4E00\u56DE\u590D\u6D88\u606F"},{from:"sdfjsd1l241511342",to:"admintestuser",id:"sdkfjs151dlfadslfiei2i2",date:"1633693512538",type:"text/plain",content:"\u8FD9\u91CC\u662Fdemo\u4E00\u56DE\u590D\u6D88\u606Fsdf"},{to:"sdfjsd1l241511342",from:"admintestuser",id:"sdkfjs5125dlfadslfiei2i2",date:"1633693532538",type:"text/plain",content:"\u8FD9\u91CC\u662Fdemo\u4E00\u56DE\u590D\u6D88\u606F\u8FD9\u91CC\u662Fdemo\u4E00\u56DE\u590D\u6D88\u606F\u8FD9\u91CC\u662Fdemo\u4E00\u56DE\u590D\u6D88\u606F"},{to:"sdfjsd1l241511342",from:"admintestuser",id:"sdkfjsdl15125fadslfiei2i2",date:"1633693571538",type:"text/plain",content:"\u8FD9\u91CC\u662Fdemo\u4E00\u56DE\u590D\u6D88\u606F\u8FD9\u91CC\u662Fdemo\u4E00\u56DE\u590D\u6D88\u606F\u8FD9\u91CC\u662Fdemo\u4E00\u56DE\u590D\u6D88\u606F"}],C;(function(e){e[e.CHANGE_ACTIVED=0]="CHANGE_ACTIVED",e[e.ADD_FIREND=1]="ADD_FIREND",e[e.SUBMIT_MSG=2]="SUBMIT_MSG",e[e.DELETE_MSG=3]="DELETE_MSG"})(C||(C={}));const $=(e,t)=>{switch(t.type){case 0:return e.activedChat!==t.payload?(e.activedChat=t.payload,v(m({},e),{activedChat:t.payload})):m({},e);case 1:return e.userList.push(t.payload),m({},e);case 2:return e.chatStream.push(t.payload),m({},e);case 3:const s=E.exports.remove(e.chatStream,o=>(console.log(o,o.id,t.payload),o.id===t.payload));return console.log(m({},e),s,"zheli"),m({},e);default:return m({},e)}},M={activedChat:"",userList:I,chatStream:V},p=d.exports.createContext(M),z=e=>{const[t,s]=d.exports.useReducer($,M);return p.Consumer,r(p.Provider,{value:[t,s],children:e.children})},y="admintestuser";var x;(function(e){e.TEXT="text/plain",e.IMG="image/*"})(x||(x={}));const N=()=>{d.exports.useState(I);const[e,t]=d.exports.useContext(p);function s(a){const i=E.exports.filter(e.chatStream,D=>D.to===a),l=E.exports.filter(e.chatStream,D=>D.from===a),h=i.concat(l);return E.exports.sortBy(h,D=>D.date)}function o(a){return a===y?"\u6211":e.userList.filter(i=>i.userId===a)[0].userName}function u(a){const i=new Date(Number(a)).getFullYear(),l=new Date(Number(a)).getMonth(),h=new Date(Number(a)).getDay(),g=new Date(Number(a)).getHours(),D=new Date(Number(a)).getMinutes();return{year:i,moth:l,day:h,h:g,m:D}}async function n(a){return await setTimeout(()=>t({type:C.DELETE_MSG,payload:a.id}),800),s(a.to),!0}function c(a,i=x.TEXT){let l;switch(i===x.IMG&&(l=URL.createObjectURL(a)),i){case x.TEXT:return r("div",{className:" text-sm opacity-80 my-2",children:a});case x.IMG:return r("img",{src:l,className:"w-full"})}}return{getFriendMsg:s,getUserById:o,renderTime:u,renderMsg:c,removeMsg:n}},S=d.exports.createContext(null),X=e=>{const{removeMsg:t}=N(),[s,o]=d.exports.useState({show:!1,title:"",content:"",method:"",params:null}),u=async()=>{s.params&&(await t(s.params),o({show:!1,title:"",content:"",method:"",params:null}))};return f(S.Provider,{value:[s,o],children:[r(B.StrictMode,{children:r(_,{title:s.title,destroyOnClose:!0,className:"w-chat-w h-chat-h ",visible:s.show,onCancel:()=>o(v(m({},s),{show:!1})),onOk:u,children:s.content})}),f("div",{className:"flex w-chat-w h-chat-h bg-white shadow-md",children:[r("div",{className:"left w-44 border-r",children:e.leftBar}),r("div",{className:"right w-full ",children:e.rightBar})]})]})},q=e=>{const[t,s]=d.exports.useContext(p),o=u=>{s({type:C.CHANGE_ACTIVED,payload:u.userId})};return f("div",{className:e.isActived?"flex w-full py-3 px-2 items-center border-t border-b cursor-pointer text-white bg-gray-600":"flex w-full py-3 px-2 items-center border-t border-b cursor-pointer",onClick:()=>o(e.userData),children:[r("div",{className:"avator w-10 rounded-lg",children:r("img",{src:e.userData.avator})}),f("div",{className:"user  px-2 text-xs",children:[e.isActived,r("div",{children:e.userData.userName}),r("div",{className:" text-xs opacity-30",children:e.userData.userIntro})]})]})},K=()=>{const[,e]=d.exports.useContext(p);return f("div",{className:"flex px-2 py-2 items-center",children:[r("div",{className:"center text-xs opacity-30 flex-grow",children:"\u597D\u53CB\u5217\u8868"}),r("div",{className:"right cursor-pointer",onClick:()=>{const s=new Date().getTime();e({type:C.ADD_FIREND,payload:{userId:"sd4"+s.toString().slice(-6),avator:"/photo.png",userName:"\u673A\u5668\u4EBA"+s.toString().slice(-5),userIntro:"\u968F\u673A\u751F\u6210\u7684\u5047\u7528\u6237"}})},children:"+"})]})},W=()=>{const[e,t]=d.exports.useContext(p);return d.exports.useEffect(()=>{},[e.activedChat]),f("div",{children:[r(K,{}),e&&e.userList&&e.userList.map(s=>r(q,{userData:s,isActived:e.activedChat===s.userId},s.userId))]})},Y=e=>f("div",{className:"flex flex-col bg-white w-full h-full relative px-3 py-2",children:[r(F,{children:e.topBar}),r(F,{children:e.toolsBar})]}),J=e=>{const{data:t}=e,[s,o]=d.exports.useContext(S),{getUserById:u,renderTime:n,renderMsg:c}=N();return r(F,{children:r("div",{className:t.to===y?"w-full flex flex-row ":"w-full flex flex-row-reverse text-right ",children:r(O,{mouseEnterDelay:.7,autoAdjustOverflow:!0,placement:t.to===y?"rightTop":"leftTop",title:()=>t.from===y?r("div",{className:"text-white cursor-pointer text-sm px-3",children:r("div",{onClick:()=>o(v(m({},s),{show:!0,title:"\u64A4\u9500\u8BE5\u6D88\u606F",params:t,method:"delete",content:"\u5220\u9664\u8FD9\u6761\u6D88\u606F"})),children:r(G.DeleteOutlined,{style:{fontSize:"18px",color:"#fff"}})})}):"",children:r("div",{className:"box w-5/12 my-1 shadow-lg rounded-md border-gray-50 px-3 py-3 cursor-pointer",children:f("div",{children:[r("div",{className:" text-xs opacity-60",children:u(t.from)}),r("div",{className:" text-xs opacity-30",children:`${n(t.date).year}-${n(t.date).moth+1}-${n(t.date).day}  ${n(t.date).h}:${n(t.date).m}`}),r("div",{className:" text-sm opacity-80 my-2",children:c(t.content,t.type)})]})})})})})},Q=e=>{const[,t]=d.exports.useContext(p),s=()=>{t({type:C.CHANGE_ACTIVED,payload:""})},o=d.exports.useRef(null);return d.exports.useEffect(()=>{e.getDisplayer(o)},[e.chatStream]),f("div",{children:[f("div",{className:"border-b border-gray-100 pb-2 text-gray-300  text-xs  text-right",children:[" ",r("span",{className:" cursor-pointer",onClick:s,children:"< \u8FD4\u56DE"})," "]}),r("div",{className:"display-container h-display-h overflow-y-scroll w-full px-5 py-2",ref:o,children:e.chatStream.map(u=>r(J,{data:u},u.id))})]})},Z=e=>{d.exports.useContext(p);const{Search:t}=R,[s,o]=d.exports.useState(""),u=l=>{o(l.target.value)},n=()=>{e.msgOnsubmit(s,x.TEXT),o("")},c=d.exports.useRef(null),a=()=>{var l;(l=c.current)==null||l.click()},i=l=>{const h=l.target.files[0];setTimeout(()=>{e.msgOnsubmit(h,x.IMG),l.target.value=""},300)};return f("div",{className:" w-full absolute bottom-0 left-0 px-3 border-t border-gray-100",children:[r("div",{className:"kits flex py-3",children:f("div",{className:"cursor-pointer",onClick:a,children:[r(U,{style:{fontSize:"16px",color:"#08c"}}),r("input",{type:"file",ref:c,accept:x.IMG,className:"hidden",onChange:i})]})}),r("div",{className:"inputer w-full flex pb-3",children:r(t,{placeholder:"\u8F93\u5165\u804A\u5929\u5185\u5BB9",enterButton:"\u53D1\u9001",maxLength:500,value:s,onChange:u,onSearch:n})})]})},ee=()=>{const[e,t]=d.exports.useContext(p),[s,o]=d.exports.useState([]),{getFriendMsg:u}=N();d.exports.useEffect(()=>{const a=u(e.activedChat);o(a)},[e]);const n=(a,i)=>{const l=new Date().getTime();if(a){t({type:C.SUBMIT_MSG,payload:{from:y,to:e.activedChat,id:"mxmchat_"+l,date:l,type:i,content:a}});const h=u(e.activedChat);o(h)}},c=a=>{var i,l,h,g;a&&a.current&&((i=a.current)==null?void 0:i.clientHeight)+((l=a.current)==null?void 0:l.scrollTop)!=((h=a.current)==null?void 0:h.scrollHeight)&&(a.current.scrollTop=(g=a.current)==null?void 0:g.scrollHeight)};return r("div",{className:"w-full h-full",children:e.activedChat?r(Y,{topBar:r(Q,{chatStream:s,getDisplayer:c}),toolsBar:r(Z,{msgOnsubmit:n})}):r("div",{className:"opacity-30 flex justify-center items-center h-full w-full bg-gray-700",children:"MxM Chat App"})})};function te(){return r(z,{children:r(X,{leftBar:r(W,{}),rightBar:r(ee,{})})})}H.render(r(B.StrictMode,{children:r(te,{})}),document.getElementById("root"));
